batch_size: 1 args.overlap: True , args.cut_gen_len: 5
<run_flexgen>: args.model: facebook/opt-30b
get_test_inputs, prompt_len:32 and batch_size:1
prompts:['Write a detailed product description for a food chopper tool that lets you chop fruits and vegetables.']
len(prompt):102
input_prompt:102
get_test_inputs, prompt_len:64 and batch_size:1
prompts:['Write a detailed product description for a food chopper tool that lets you chop fruits and vegetables.']
len(prompt):102
input_prompt:102
model size: 55.803 GB, cache size: 0.246 GB, hidden size (prefill): 0.003 GB
init weight...
Load the pre-trained pytorch weights of opt-30b from huggingface. The downloading and cpu loading can take dozens of minutes. If it seems to get stuck, you can monitor the progress by checking the memory usage of this process.
Fetching 7 files:   0%|          | 0/7 [00:00<?, ?it/s]Fetching 7 files: 100%|██████████| 7/7 [00:00<00:00, 95016.60it/s]
Convert format:   0%|          | 0/7 [00:00<?, ?it/s]
  0%|          | 0/128 [00:00<?, ?it/s][A
  1%|          | 1/128 [00:00<00:34,  3.65it/s][A
  2%|▏         | 3/128 [00:00<00:22,  5.45it/s][A
  7%|▋         | 9/128 [00:00<00:07, 15.79it/s][A
 10%|█         | 13/128 [00:00<00:06, 18.96it/s][A
 13%|█▎        | 17/128 [00:01<00:06, 16.28it/s][A
 15%|█▍        | 19/128 [00:01<00:08, 12.41it/s][A
 20%|█▉        | 25/128 [00:01<00:05, 18.37it/s][A
 23%|██▎       | 29/128 [00:01<00:04, 20.13it/s][A
 26%|██▌       | 33/128 [00:02<00:05, 17.34it/s][A
 28%|██▊       | 36/128 [00:02<00:06, 14.62it/s][A
 32%|███▏      | 41/128 [00:02<00:04, 18.41it/s][A
 35%|███▌      | 45/128 [00:02<00:04, 20.24it/s][A
 38%|███▊      | 49/128 [00:03<00:04, 17.47it/s][A
 41%|████      | 52/128 [00:03<00:05, 14.76it/s][A
 45%|████▍     | 57/128 [00:03<00:03, 18.48it/s][A
 48%|████▊     | 61/128 [00:03<00:03, 20.25it/s][A
 51%|█████     | 65/128 [00:03<00:03, 17.44it/s][A
 53%|█████▎    | 68/128 [00:04<00:04, 14.74it/s][A
 57%|█████▋    | 73/128 [00:04<00:02, 18.43it/s][A
 60%|██████    | 77/128 [00:04<00:02, 20.23it/s][A
 63%|██████▎   | 81/128 [00:04<00:02, 17.43it/s][A
 66%|██████▌   | 84/128 [00:05<00:02, 14.73it/s][A
 70%|██████▉   | 89/128 [00:05<00:02, 18.47it/s][A
 73%|███████▎  | 93/128 [00:05<00:01, 20.21it/s][A
 76%|███████▌  | 97/128 [00:05<00:01, 17.43it/s][A
 78%|███████▊  | 100/128 [00:06<00:01, 14.74it/s][A
 82%|████████▏ | 105/128 [00:06<00:01, 18.44it/s][A
 85%|████████▌ | 109/128 [00:06<00:00, 20.22it/s][A
 88%|████████▊ | 113/128 [00:06<00:00, 17.45it/s][A
 91%|█████████ | 116/128 [00:06<00:00, 14.66it/s][A
 95%|█████████▍| 121/128 [00:07<00:00, 18.17it/s][A
 98%|█████████▊| 125/128 [00:07<00:00, 19.84it/s][A
                                                 [AConvert format:  14%|█▍        | 1/7 [00:17<01:45, 17.66s/it]
  0%|          | 0/128 [00:00<?, ?it/s][A
  1%|          | 1/128 [00:00<00:34,  3.64it/s][A
  2%|▏         | 3/128 [00:00<00:23,  5.39it/s][A
  7%|▋         | 9/128 [00:00<00:07, 15.56it/s][A
 10%|█         | 13/128 [00:00<00:06, 18.63it/s][A
 13%|█▎        | 17/128 [00:01<00:06, 15.99it/s][A
 15%|█▍        | 19/128 [00:01<00:08, 12.24it/s][A
 20%|█▉        | 25/128 [00:01<00:05, 18.13it/s][A
 23%|██▎       | 29/128 [00:01<00:04, 20.01it/s][A
 26%|██▌       | 33/128 [00:02<00:05, 17.17it/s][A
 28%|██▊       | 36/128 [00:02<00:06, 14.46it/s][A
 32%|███▏      | 41/128 [00:02<00:04, 18.22it/s][A
 35%|███▌      | 45/128 [00:02<00:04, 20.00it/s][A
 38%|███▊      | 49/128 [00:03<00:04, 17.25it/s][A
 41%|████      | 52/128 [00:03<00:05, 14.54it/s][A
 45%|████▍     | 57/128 [00:03<00:03, 18.24it/s][A
 48%|████▊     | 61/128 [00:03<00:03, 19.99it/s][A
 51%|█████     | 65/128 [00:03<00:03, 17.26it/s][A
 52%|█████▏    | 67/128 [00:04<00:04, 13.40it/s][A
 57%|█████▋    | 73/128 [00:04<00:02, 18.63it/s][A
 60%|██████    | 77/128 [00:04<00:02, 20.27it/s][A
 63%|██████▎   | 81/128 [00:04<00:02, 17.45it/s][A
 66%|██████▌   | 84/128 [00:05<00:03, 14.57it/s][A
 70%|██████▉   | 89/128 [00:05<00:02, 18.04it/s][A
 73%|███████▎  | 93/128 [00:05<00:01, 19.59it/s][A
 76%|███████▌  | 97/128 [00:05<00:01, 16.49it/s][A
 77%|███████▋  | 99/128 [00:06<00:02, 12.90it/s][A
 82%|████████▏ | 105/128 [00:06<00:01, 17.65it/s][A
 85%|████████▌ | 109/128 [00:06<00:01, 18.96it/s][A
 88%|████████▊ | 113/128 [00:06<00:00, 16.69it/s][A
 90%|████████▉ | 115/128 [00:07<00:01, 12.91it/s][A
 94%|█████████▍| 120/128 [00:07<00:00, 17.98it/s][A
 96%|█████████▌| 123/128 [00:07<00:00, 18.17it/s][A
                                                 [AConvert format:  29%|██▊       | 2/7 [00:48<02:06, 25.34s/it]
  0%|          | 0/128 [00:00<?, ?it/s][A
  1%|          | 1/128 [00:00<00:41,  3.03it/s][A
  2%|▏         | 3/128 [00:00<00:25,  4.84it/s][A
  5%|▌         | 7/128 [00:00<00:10, 11.87it/s][A
  9%|▊         | 11/128 [00:00<00:07, 15.89it/s][A
 12%|█▎        | 16/128 [00:01<00:04, 22.87it/s][A
 16%|█▌        | 20/128 [00:01<00:09, 11.91it/s][A
 18%|█▊        | 23/128 [00:01<00:07, 14.21it/s][A
 21%|██        | 27/128 [00:01<00:06, 16.39it/s][A
 26%|██▌       | 33/128 [00:02<00:06, 15.69it/s][A
 28%|██▊       | 36/128 [00:02<00:06, 13.58it/s][A
 30%|███       | 39/128 [00:02<00:05, 15.69it/s][A
 34%|███▎      | 43/128 [00:02<00:04, 17.76it/s][A
 38%|███▊      | 49/128 [00:03<00:04, 16.38it/s][A
 40%|███▉      | 51/128 [00:03<00:05, 13.03it/s][A
 43%|████▎     | 55/128 [00:03<00:04, 16.53it/s][A
 46%|████▌     | 59/128 [00:03<00:03, 18.47it/s][A
 51%|█████     | 65/128 [00:04<00:03, 16.97it/s][A
 53%|█████▎    | 68/128 [00:04<00:04, 14.41it/s][A
 55%|█████▌    | 71/128 [00:04<00:03, 16.44it/s][A
 59%|█████▊    | 75/128 [00:04<00:02, 18.43it/s][A
 62%|██████▎   | 80/128 [00:05<00:02, 23.41it/s][A
 65%|██████▍   | 83/128 [00:05<00:03, 12.27it/s][A
 70%|██████▉   | 89/128 [00:05<00:02, 16.66it/s][A
 73%|███████▎  | 93/128 [00:05<00:01, 18.25it/s][A
 76%|███████▌  | 97/128 [00:06<00:01, 15.87it/s][A
 78%|███████▊  | 100/128 [00:06<00:02, 13.49it/s][A
 80%|████████  | 103/128 [00:06<00:01, 15.57it/s][A
 84%|████████▎ | 107/128 [00:06<00:01, 17.49it/s][A
 88%|████████▊ | 112/128 [00:07<00:00, 22.54it/s][A
 90%|████████▉ | 115/128 [00:07<00:01, 11.95it/s][A
 93%|█████████▎| 119/128 [00:07<00:00, 15.20it/s][A
 96%|█████████▌| 123/128 [00:07<00:00, 17.08it/s][A
100%|██████████| 128/128 [00:08<00:00, 21.91it/s][A
                                                 [AConvert format:  43%|████▎     | 3/7 [01:08<01:32, 23.14s/it]
  0%|          | 0/6 [00:00<?, ?it/s][A
 17%|█▋        | 1/6 [00:00<00:01,  3.14it/s][A
 50%|█████     | 3/6 [00:00<00:00,  5.03it/s][A
                                             [AConvert format:  57%|█████▋    | 4/7 [01:11<00:45, 15.12s/it]
  0%|          | 0/128 [00:00<?, ?it/s][A
  1%|          | 1/128 [00:00<00:39,  3.20it/s][A
  2%|▏         | 3/128 [00:00<00:24,  5.08it/s][A
  7%|▋         | 9/128 [00:00<00:08, 14.60it/s][A
 10%|█         | 13/128 [00:00<00:06, 17.51it/s][A
 13%|█▎        | 17/128 [00:01<00:07, 14.87it/s][A
 15%|█▍        | 19/128 [00:01<00:09, 11.50it/s][A
 20%|█▉        | 25/128 [00:01<00:06, 16.95it/s][A
 23%|██▎       | 29/128 [00:01<00:05, 18.68it/s][A
 26%|██▌       | 33/128 [00:02<00:05, 15.91it/s][A
 27%|██▋       | 35/128 [00:02<00:07, 12.51it/s][A
 30%|███       | 39/128 [00:02<00:05, 15.88it/s][A
 33%|███▎      | 42/128 [00:02<00:04, 17.30it/s][A
 35%|███▌      | 45/128 [00:03<00:04, 16.89it/s][A
 38%|███▊      | 49/128 [00:03<00:05, 14.71it/s][A
 40%|███▉      | 51/128 [00:03<00:07,  9.69it/s][A
 43%|████▎     | 55/128 [00:04<00:05, 12.81it/s][A
 45%|████▍     | 57/128 [00:04<00:05, 13.13it/s][A
 46%|████▌     | 59/128 [00:04<00:05, 13.44it/s][A
 48%|████▊     | 61/128 [00:04<00:04, 13.88it/s][A
 51%|█████     | 65/128 [00:04<00:06, 10.19it/s][A
 52%|█████▏    | 67/128 [00:05<00:11,  5.47it/s][A
 55%|█████▌    | 71/128 [00:06<00:07,  7.28it/s][A
 57%|█████▋    | 73/128 [00:06<00:07,  7.34it/s][A
 59%|█████▊    | 75/128 [00:06<00:07,  7.39it/s][A
 60%|██████    | 77/128 [00:06<00:06,  7.42it/s][A
 63%|██████▎   | 81/128 [00:08<00:08,  5.26it/s][A
 65%|██████▍   | 83/128 [00:09<00:12,  3.71it/s][A
 68%|██████▊   | 87/128 [00:09<00:07,  5.31it/s][A
 70%|██████▉   | 89/128 [00:09<00:06,  5.67it/s][A
 71%|███████   | 91/128 [00:09<00:06,  6.06it/s][A
 73%|███████▎  | 93/128 [00:10<00:05,  6.35it/s][A
 76%|███████▌  | 97/128 [00:11<00:07,  3.95it/s][A
 77%|███████▋  | 99/128 [00:13<00:12,  2.32it/s][A
 80%|████████  | 103/128 [00:14<00:07,  3.23it/s][A
 82%|████████▏ | 105/128 [00:14<00:06,  3.36it/s][A
 84%|████████▎ | 107/128 [00:15<00:06,  3.48it/s][A
 85%|████████▌ | 109/128 [00:15<00:05,  3.59it/s][A
 88%|████████▊ | 113/128 [00:17<00:05,  2.67it/s][A
 90%|████████▉ | 115/128 [00:19<00:06,  1.91it/s][A
 93%|█████████▎| 119/128 [00:20<00:03,  2.74it/s][A
 95%|█████████▍| 121/128 [00:20<00:02,  2.94it/s][A
 96%|█████████▌| 123/128 [00:21<00:01,  3.12it/s][A
 98%|█████████▊| 125/128 [00:21<00:00,  3.31it/s][A
                                                 [AConvert format:  71%|███████▏  | 5/7 [01:45<00:43, 21.82s/it]
  0%|          | 0/128 [00:00<?, ?it/s][A
  1%|          | 1/128 [00:00<01:09,  1.82it/s][A
  2%|▏         | 3/128 [00:01<00:55,  2.27it/s][A
  4%|▍         | 5/128 [00:01<00:29,  4.15it/s][A
  5%|▌         | 7/128 [00:01<00:20,  5.84it/s][A
  7%|▋         | 9/128 [00:01<00:18,  6.51it/s][A
  9%|▊         | 11/128 [00:02<00:16,  6.92it/s][A
 10%|█         | 13/128 [00:02<00:15,  7.22it/s][A
 13%|█▎        | 17/128 [00:03<00:23,  4.69it/s][A
 15%|█▍        | 19/128 [00:05<00:45,  2.39it/s][A
 18%|█▊        | 23/128 [00:06<00:31,  3.38it/s][A
 20%|█▉        | 25/128 [00:06<00:29,  3.50it/s][A
 21%|██        | 27/128 [00:07<00:28,  3.61it/s][A
 23%|██▎       | 29/128 [00:07<00:26,  3.69it/s][A
 26%|██▌       | 33/128 [00:09<00:35,  2.69it/s][A
 27%|██▋       | 35/128 [00:11<00:48,  1.91it/s][A
 30%|███       | 39/128 [00:12<00:32,  2.75it/s][A
 32%|███▏      | 41/128 [00:12<00:31,  2.81it/s][A
 34%|███▎      | 43/128 [00:13<00:31,  2.73it/s][A
 35%|███▌      | 45/128 [00:14<00:31,  2.67it/s][A
 38%|███▊      | 49/128 [00:17<00:43,  1.83it/s][A
 40%|███▉      | 51/128 [00:20<01:00,  1.27it/s][A
 43%|████▎     | 55/128 [00:21<00:40,  1.81it/s][A
 45%|████▍     | 57/128 [00:22<00:36,  1.94it/s][A
 46%|████▌     | 59/128 [00:23<00:33,  2.05it/s][A
 48%|████▊     | 61/128 [00:23<00:31,  2.16it/s][A
 51%|█████     | 65/128 [00:27<00:37,  1.66it/s][A
 52%|█████▏    | 67/128 [00:30<00:50,  1.21it/s][A
 55%|█████▌    | 71/128 [00:30<00:32,  1.74it/s][A
 57%|█████▋    | 73/128 [00:31<00:29,  1.87it/s][A
 59%|█████▊    | 75/128 [00:32<00:26,  2.00it/s][A
 60%|██████    | 77/128 [00:33<00:24,  2.11it/s][A
 63%|██████▎   | 81/128 [00:36<00:28,  1.65it/s][A
 65%|██████▍   | 83/128 [00:39<00:37,  1.20it/s][A
 68%|██████▊   | 87/128 [00:40<00:23,  1.73it/s][A
 70%|██████▉   | 89/128 [00:41<00:20,  1.86it/s][A
 71%|███████   | 91/128 [00:41<00:18,  1.99it/s][A
 73%|███████▎  | 93/128 [00:42<00:16,  2.10it/s][A
 76%|███████▌  | 97/128 [00:45<00:18,  1.65it/s][A
 77%|███████▋  | 99/128 [00:49<00:24,  1.20it/s][A
 80%|████████  | 103/128 [00:49<00:14,  1.73it/s][A
 82%|████████▏ | 105/128 [00:50<00:12,  1.86it/s][A
 84%|████████▎ | 107/128 [00:51<00:10,  1.99it/s][A
 85%|████████▌ | 109/128 [00:52<00:09,  2.11it/s][A
 88%|████████▊ | 113/128 [00:55<00:09,  1.64it/s][A
 90%|████████▉ | 115/128 [00:58<00:10,  1.20it/s][A
 93%|█████████▎| 119/128 [00:59<00:05,  1.73it/s][A
 95%|█████████▍| 121/128 [01:00<00:03,  1.86it/s][A
 96%|█████████▌| 123/128 [01:00<00:02,  1.99it/s][A
 98%|█████████▊| 125/128 [01:01<00:01,  2.10it/s][A
                                                 [AConvert format:  86%|████████▌ | 6/7 [03:13<00:44, 44.44s/it]
  0%|          | 0/126 [00:00<?, ?it/s][A
  1%|          | 1/126 [00:02<05:22,  2.58s/it][A
  4%|▍         | 5/126 [00:02<00:54,  2.21it/s][A
  6%|▌         | 7/126 [00:03<00:40,  2.97it/s][A
  7%|▋         | 9/126 [00:03<00:35,  3.26it/s][A
  9%|▊         | 11/126 [00:04<00:33,  3.44it/s][A
 12%|█▏        | 15/126 [00:06<00:43,  2.52it/s][A
 13%|█▎        | 17/126 [00:08<01:00,  1.80it/s][A
 17%|█▋        | 21/126 [00:08<00:39,  2.68it/s][A
 18%|█▊        | 23/126 [00:09<00:35,  2.90it/s][A
 20%|█▉        | 25/126 [00:09<00:32,  3.11it/s][A
 21%|██▏       | 27/126 [00:10<00:30,  3.28it/s][A
 25%|██▍       | 31/126 [00:12<00:40,  2.34it/s][A
 26%|██▌       | 33/126 [00:15<01:04,  1.44it/s][A
 29%|██▉       | 37/126 [00:16<00:44,  2.02it/s][A
 31%|███       | 39/126 [00:17<00:41,  2.11it/s][A
 33%|███▎      | 41/126 [00:18<00:38,  2.20it/s][A
 34%|███▍      | 43/126 [00:18<00:36,  2.26it/s][A
 37%|███▋      | 47/126 [00:22<00:46,  1.70it/s][A
 39%|███▉      | 49/126 [00:25<01:02,  1.23it/s][A
 42%|████▏     | 53/126 [00:26<00:41,  1.76it/s][A
 44%|████▎     | 55/126 [00:26<00:37,  1.88it/s][A
 45%|████▌     | 57/126 [00:27<00:34,  2.01it/s][A
 47%|████▋     | 59/126 [00:28<00:31,  2.12it/s][A
 50%|█████     | 63/126 [00:31<00:38,  1.65it/s][A
 52%|█████▏    | 65/126 [00:34<00:50,  1.20it/s][A
 55%|█████▍    | 69/126 [00:35<00:32,  1.73it/s][A
 56%|█████▋    | 71/126 [00:36<00:29,  1.86it/s][A
 58%|█████▊    | 73/126 [00:37<00:26,  1.99it/s][A
 60%|█████▉    | 75/126 [00:37<00:24,  2.10it/s][A
 63%|██████▎   | 79/126 [00:41<00:28,  1.65it/s][A
 64%|██████▍   | 81/126 [00:44<00:37,  1.20it/s][A
 67%|██████▋   | 85/126 [00:44<00:23,  1.73it/s][A
 69%|██████▉   | 87/126 [00:45<00:21,  1.86it/s][A
 71%|███████   | 89/126 [00:46<00:18,  1.98it/s][A
 72%|███████▏  | 91/126 [00:47<00:16,  2.10it/s][A
 75%|███████▌  | 95/126 [00:50<00:18,  1.64it/s][A
 77%|███████▋  | 97/126 [00:53<00:24,  1.20it/s][A
 80%|████████  | 101/126 [00:54<00:14,  1.73it/s][A
 82%|████████▏ | 103/126 [00:55<00:12,  1.86it/s][A
 83%|████████▎ | 105/126 [00:56<00:10,  1.98it/s][A
 85%|████████▍ | 107/126 [00:56<00:09,  2.10it/s][A
 88%|████████▊ | 111/126 [00:59<00:08,  1.71it/s][A
 90%|████████▉ | 113/126 [01:02<00:10,  1.22it/s][A
 93%|█████████▎| 117/126 [01:03<00:05,  1.74it/s][A
 94%|█████████▍| 119/126 [01:04<00:03,  1.89it/s][A
 96%|█████████▌| 121/126 [01:05<00:02,  2.01it/s][A
 98%|█████████▊| 123/126 [01:06<00:01,  2.11it/s][A
                                                 [AConvert format: 100%|██████████| 7/7 [04:52<00:00, 62.26s/it]Convert format: 100%|██████████| 7/7 [04:52<00:00, 41.82s/it]
/home/lambda/.local/lib/python3.10/site-packages/torch/distributed/distributed_c10d.py:262: UserWarning: torch.distributed.reduce_op is deprecated, please use torch.distributed.ReduceOp instead
  warnings.warn(
warmup - generate
benchmark - generate
decode_costs: [9.68730949899873, 9.681492428000638, 9.681214235999505, 9.56461451299947]
Outputs:
----------------------------------------------------------------------
0: Write a detailed product description for a food chopper tool that lets you chop fruits and vegetables.

The food cho
----------------------------------------------------------------------

TorchDevice: cuda:0
  cur_mem: 0.0000 GB,  peak_mem: 1.6902 GB
TorchDevice: cpu
  cur_mem: 56.5031 GB,  peak_mem: 0.0000 GB
model size: 55.803 GB	cache size: 0.246 GB	hidden size (p): 0.003 GB
peak gpu mem: 1.690 GB	projected: True
prefill latency: 9.685 s	prefill throughput: 6.608 token/s
decode latency: 1222.233 s	decode throughput: 0.104 token/s
total latency: 1231.918 s	total throughput: 0.104 token/s
