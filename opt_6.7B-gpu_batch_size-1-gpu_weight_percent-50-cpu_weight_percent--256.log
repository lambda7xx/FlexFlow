batch_size: 1 args.overlap: True , args.cut_gen_len: 5
<run_flexgen>: args.model: facebook/opt-6.7b
get_test_inputs, prompt_len:32 and batch_size:1
prompts:['Write a detailed product description for a food chopper tool that lets you chop fruits and vegetables.']
len(prompt):102
input_prompt:102
get_test_inputs, prompt_len:64 and batch_size:1
prompts:['Write a detailed product description for a food chopper tool that lets you chop fruits and vegetables.']
len(prompt):102
input_prompt:102
model size: 12.386 GB, cache size: 0.156 GB, hidden size (prefill): 0.002 GB
init weight...
Load the pre-trained pytorch weights of opt-6.7b from huggingface. The downloading and cpu loading can take dozens of minutes. If it seems to get stuck, you can monitor the progress by checking the memory usage of this process.
Fetching 2 files:   0%|          | 0/2 [00:00<?, ?it/s]Fetching 2 files: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2/2 [00:00<00:00, 39199.10it/s]
Convert format:   0%|          | 0/2 [00:00<?, ?it/s]
  0%|          | 0/132 [00:00<?, ?it/s][A
  1%|          | 1/132 [00:00<00:13,  9.72it/s][A
  7%|â–‹         | 9/132 [00:00<00:02, 45.75it/s][A
 11%|â–ˆâ–        | 15/132 [00:00<00:02, 40.06it/s][A
 15%|â–ˆâ–Œ        | 20/132 [00:00<00:02, 39.20it/s][A
 20%|â–ˆâ–‰        | 26/132 [00:00<00:02, 45.28it/s][A
 23%|â–ˆâ–ˆâ–Ž       | 31/132 [00:00<00:02, 39.84it/s][A
 27%|â–ˆâ–ˆâ–‹       | 36/132 [00:00<00:02, 38.25it/s][A
 32%|â–ˆâ–ˆâ–ˆâ–      | 42/132 [00:01<00:02, 43.53it/s][A
 36%|â–ˆâ–ˆâ–ˆâ–Œ      | 47/132 [00:01<00:02, 40.33it/s][A
 39%|â–ˆâ–ˆâ–ˆâ–‰      | 52/132 [00:01<00:01, 40.84it/s][A
 44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 58/132 [00:01<00:01, 45.74it/s][A
 48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 63/132 [00:01<00:01, 40.62it/s][A
 52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 68/132 [00:01<00:01, 39.18it/s][A
 56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 74/132 [00:01<00:01, 44.02it/s][A
 60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 79/132 [00:01<00:01, 40.74it/s][A
 64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 84/132 [00:02<00:01, 38.94it/s][A
 68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 90/132 [00:02<00:00, 43.85it/s][A
 72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 95/132 [00:02<00:00, 39.59it/s][A
 76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 100/132 [00:02<00:00, 39.15it/s][A
 80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 106/132 [00:02<00:00, 44.21it/s][A
 84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 111/132 [00:02<00:00, 39.54it/s][A
 88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 116/132 [00:02<00:00, 38.89it/s][A
 92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 122/132 [00:02<00:00, 43.75it/s][A
 96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 127/132 [00:03<00:00, 39.87it/s][A
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 132/132 [00:03<00:00, 38.37it/s][A
                                                 [AConvert format:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 1/2 [00:08<00:08,  8.42s/it]
  0%|          | 0/384 [00:00<?, ?it/s][A
  0%|          | 1/384 [00:00<03:30,  1.82it/s][A
  4%|â–         | 15/384 [00:00<00:14, 25.83it/s][A
  5%|â–Œ         | 21/384 [00:00<00:11, 32.05it/s][A
  8%|â–Š         | 31/384 [00:00<00:08, 42.09it/s][A
 10%|â–‰         | 37/384 [00:01<00:07, 45.10it/s][A
 12%|â–ˆâ–        | 47/384 [00:01<00:06, 51.48it/s][A
 14%|â–ˆâ–        | 53/384 [00:01<00:06, 52.34it/s][A
 16%|â–ˆâ–‹        | 63/384 [00:01<00:05, 56.61it/s][A
 18%|â–ˆâ–Š        | 69/384 [00:01<00:05, 56.18it/s][A
 21%|â–ˆâ–ˆ        | 79/384 [00:01<00:05, 59.21it/s][A
 22%|â–ˆâ–ˆâ–       | 86/384 [00:01<00:04, 60.39it/s][A
 25%|â–ˆâ–ˆâ–       | 95/384 [00:02<00:04, 59.90it/s][A
 27%|â–ˆâ–ˆâ–‹       | 102/384 [00:02<00:04, 60.91it/s][A
 29%|â–ˆâ–ˆâ–‰       | 111/384 [00:02<00:04, 60.32it/s][A
 31%|â–ˆâ–ˆâ–ˆ       | 118/384 [00:02<00:04, 61.22it/s][A
 33%|â–ˆâ–ˆâ–ˆâ–Ž      | 127/384 [00:02<00:04, 60.46it/s][A
 35%|â–ˆâ–ˆâ–ˆâ–      | 134/384 [00:02<00:04, 61.46it/s][A
 37%|â–ˆâ–ˆâ–ˆâ–‹      | 143/384 [00:02<00:03, 60.58it/s][A
 39%|â–ˆâ–ˆâ–ˆâ–‰      | 150/384 [00:02<00:03, 61.44it/s][A
 41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 159/384 [00:03<00:03, 60.56it/s][A
 43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 166/384 [00:03<00:03, 61.41it/s][A
 46%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 175/384 [00:03<00:03, 60.55it/s][A
 47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 182/384 [00:03<00:03, 61.39it/s][A
 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 191/384 [00:03<00:03, 60.67it/s][A
 52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 198/384 [00:03<00:03, 61.47it/s][A
 54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 207/384 [00:03<00:02, 60.60it/s][A
 56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 214/384 [00:03<00:02, 61.53it/s][A
 58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 223/384 [00:04<00:02, 60.61it/s][A
 60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 230/384 [00:04<00:02, 61.48it/s][A
 62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 239/384 [00:04<00:02, 60.73it/s][A
 64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 246/384 [00:04<00:02, 61.66it/s][A
 66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 255/384 [00:04<00:02, 60.69it/s][A
 68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 262/384 [00:04<00:01, 61.52it/s][A
 71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 271/384 [00:04<00:01, 60.71it/s][A
 72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 278/384 [00:05<00:01, 61.51it/s][A
 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 287/384 [00:05<00:01, 60.61it/s][A
 77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 294/384 [00:05<00:01, 61.52it/s][A
 79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 303/384 [00:05<00:01, 60.70it/s][A
 81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 310/384 [00:05<00:01, 61.55it/s][A
 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 319/384 [00:05<00:01, 60.68it/s][A
 85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 326/384 [00:05<00:00, 61.51it/s][A
 87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 335/384 [00:05<00:00, 60.62it/s][A
 89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 342/384 [00:06<00:00, 61.43it/s][A
 91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 351/384 [00:06<00:00, 60.63it/s][A
 93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 358/384 [00:06<00:00, 61.53it/s][A
 96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 367/384 [00:06<00:00, 60.67it/s][A
 97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 374/384 [00:06<00:00, 61.54it/s][A
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰| 383/384 [00:06<00:00, 60.63it/s][A
                                                 [AConvert format: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2/2 [01:25<00:00, 48.81s/it]Convert format: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2/2 [01:25<00:00, 42.75s/it]
/home/lambda/.local/lib/python3.10/site-packages/torch/distributed/distributed_c10d.py:262: UserWarning: torch.distributed.reduce_op is deprecated, please use torch.distributed.ReduceOp instead
  warnings.warn(
warmup - generate
benchmark - generate
decode_costs: [1.1052930189998733, 1.0991261950002809, 1.0987427250001929, 1.0346639929994126]
Outputs:
----------------------------------------------------------------------
0: Write a detailed product description for a food chopper tool that lets you chop fruits and vegetables.

Write a detailed
----------------------------------------------------------------------

TorchDevice: cuda:0
  cur_mem: 6.4009 GB,  peak_mem: 7.0047 GB
TorchDevice: cpu
  cur_mem: 6.3850 GB,  peak_mem: 0.0000 GB
model size: 12.386 GB	cache size: 0.156 GB	hidden size (p): 0.002 GB
peak gpu mem: 7.005 GB	projected: True
prefill latency: 1.100 s	prefill throughput: 58.170 token/s
decode latency: 272.080 s	decode throughput: 0.937 token/s
total latency: 273.181 s	total throughput: 0.937 token/s
